<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Chess Game</title>
		
		<style>
			body {
				margin: 0;
				display: flex;
				align-items: center;
				justify-content: center;
				height: 100vh;
				background-color: #f0f0f0;
			}

			canvas {
				border: 1px solid #333;
			}
		</style>
	</head>

	<body>
		<canvas id="chessCanvas"></canvas>

		<script>
			
			var mousePos = {x: 0, y: 0};
			var mouseDrag = false;
			var mouseChange = false;
			
			const pieceNames = [
				"Images/ChessPiece_Rook_Black.png",
				"Images/ChessPiece_Knight_Black.png",
				"Images/ChessPiece_Bishop_Black.png",
				"Images/ChessPiece_King_Black.png",
				"Images/ChessPiece_Queen_Black.png",
				"Images/ChessPiece_Pawn_Black.png",
				"Images/ChessPiece_Rook_White.png",
				"Images/ChessPiece_Knight_White.png",
				"Images/ChessPiece_Bishop_White.png",
				"Images/ChessPiece_King_White.png",
				"Images/ChessPiece_Queen_White.png",
				"Images/ChessPiece_Pawn_White.png"
			];
			
			var pieceImages = [];
			for (var i = 0; i < pieceNames.length; i++) {
				pieceImages[i] = new Image();
				pieceImages[i].src = pieceNames[i];
			}
			var pieceScale = .9;
			var pieceDrag = -1;
			var pieceSave = {};
			
			var pieces = [
				{type: 0, color: 0, x: 0, y: 0},
				{type: 1, color: 0, x: 1, y: 0},
				{type: 2, color: 0, x: 2, y: 0},
				{type: 3, color: 0, x: 3, y: 0},
				{type: 4, color: 0, x: 4, y: 0},
				{type: 2, color: 0, x: 5, y: 0},
				{type: 1, color: 0, x: 6, y: 0},
				{type: 0, color: 0, x: 7, y: 0},
				{type: 5, color: 0, x: 0, y: 1},
				{type: 5, color: 0, x: 1, y: 1},
				{type: 5, color: 0, x: 2, y: 1},
				{type: 5, color: 0, x: 3, y: 1},
				{type: 5, color: 0, x: 4, y: 1},
				{type: 5, color: 0, x: 5, y: 1},
				{type: 5, color: 0, x: 6, y: 1},
				{type: 5, color: 0, x: 7, y: 1}
			];
			for (var i = 0; i < 16; i++) {
				pieces[i + 16] = {
					type: pieces[i].type,
					color: 1,
					x: pieces[i].x,
					y: 7 - pieces[i].y,
				};
			}
			
			const canvas = document.getElementById("chessCanvas");
			const ctx = canvas.getContext("2d");

			function resizeCanvas() {
				const minSize = Math.min(window.innerWidth, window.innerHeight);
				canvas.width = minSize * 0.8;
				canvas.height = canvas.width;
			}

			function drawBoard() {
				ctx.clearRect(0, 0, canvas.width, canvas.height);
				ctx.imageSmoothingEnabled = false;

				const squareSize = canvas.width / 8;
				
				ctx.fillStyle = "#f0d9b5";
				ctx.fillRect(0, 0, squareSize * 8, squareSize * 8)
				ctx.fillStyle = "#b58863";
				for (var i = 0; i < 8; i++) {
					for (var j = 0; j < 8; j++) {
						if ((i + j) % 2) {
							ctx.fillRect(i * squareSize, j * squareSize, squareSize, squareSize);
						}
					}
				}
				
				var mousePos2 = {
					x: Math.min(Math.max((mousePos.x - canvas.getBoundingClientRect().left) / squareSize, 0.5), 7.5),
					y: Math.min(Math.max((mousePos.y - canvas.getBoundingClientRect().top) / squareSize, 0.5), 7.5)
				};
				
				var mouseCell = {
					x: Math.floor(mousePos2.x),
					y: Math.floor(mousePos2.y)
				};
				
				if (mouseChange) {
					if (mouseDrag) {
						for (var i = 0; i < pieces.length; i++) {
							if (pieces[i].x == mouseCell.x && pieces[i].y == mouseCell.y) {
								pieceDrag = i;
								pieceSave = {
									x: pieces[i].x,
									y: pieces[i].y
								};
								break;
							}
						}
					} else if (pieceDrag >= 0) {
						pieces[pieceDrag].x = mouseCell.x;
						pieces[pieceDrag].y = mouseCell.y;
						if (pieceSave.x != mouseCell.x || pieceSave.y != mouseCell.y) {
							for (var i = 0; i < pieces.length; i++) {
								if (i != pieceDrag) {
									if (pieces[i].x == mouseCell.x && pieces[i].y == mouseCell.y) {
										pieces.splice(i, 1);
										break;
									}
								}
							}
						} else {
							// no move
						}
						pieceDrag = -1;
					}
				}
				
				for (var i = 0; i < pieces.length; i++) {
					if (pieceDrag != i) {
						ctx.drawImage(pieceImages[pieces[i].type + pieces[i].color * 6], squareSize * (pieces[i].x + .5 - pieceScale / 2), squareSize * (pieces[i].y + .5 - pieceScale / 2), squareSize * pieceScale, squareSize * pieceScale);
					}
				}
				if (pieceDrag >= 0) {
					for (var i = 0; i < pieces.length; i++) {
						if (pieceDrag == i) {
							ctx.drawImage(pieceImages[pieces[i].type + pieces[i].color * 6], squareSize * (mousePos2.x - pieceScale / 2), squareSize * (mousePos2.y - pieceScale / 2), squareSize * pieceScale, squareSize * pieceScale);
						}
					}
				}
				
				mouseChange = false;
			}

			function updateCanvas() {
				resizeCanvas();
				drawBoard();
				requestAnimationFrame(updateCanvas);
			}

			updateCanvas();

			window.addEventListener("resize", updateCanvas);
			
			document.addEventListener('mousemove', (event) => {
				mousePos = {
					x: event.clientX,
					y: event.clientY,
				}
			});
			
			document.addEventListener('mousedown', (event) => {
				mouseDrag = true;
				mouseChange = true;
			});
			
			document.addEventListener('mouseup', (event) => {
				mouseDrag = false;
				mouseChange = true;
			});
			
		</script>
	</body>
</html>
